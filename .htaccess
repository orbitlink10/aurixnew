<IfModule mod_rewrite.c>
    RewriteEngine On

    # Allow ACME challenges (Let's Encrypt)
    RewriteRule ^\.well-known/ - [L]

    # Block hidden files (except .well-known)
    RewriteRule ^\.(?!well-known/) - [F,L]

    # Prevent direct access to non-public application directories/files
    RewriteRule ^(app|bootstrap|config|database|resources|routes|storage|tests|vendor)/ - [F,L]
    RewriteRule ^(artisan|composer\.(json|lock)|package(-lock)?\.json|phpunit\.xml|vite\.config\.js)$ - [F,L]

    # If someone hits /public in the URL, redirect to the clean path
    RewriteRule ^public$ / [R=301,L]
    RewriteRule ^public/(.*)$ /$1 [R=301,L]

    # Send all requests to /public without exposing it in the URL
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>
